@prefix sh:	<http://www.w3.org/ns/shacl#>.
@prefix ex: <http://www.w3.org/2022/example#> .
@prefix property: <http://www.dke-pr/property#> .
@prefix state: <http://www.dke-pr/state#> .
@prefix response: <http://www.dke-pr/response#> .
@prefix aggregation: <http://www.dke-pr/aggregation#>.
@prefix aircraft: <http://www.dke-pr/aircraft#>.

ex:AggregationShape a sh:NodeShape ;
    sh:targetClass aggregation:Aggregation ;
    sh:closed true ;

    sh:rule [
         a sh:SPARQLRule ;
         sh:prefixes ex:, property: , state:, aggregation:, aircraft: ;
         sh:construct """
                PREFIX ex: <http://www.w3.org/2022/example#>
                PREFIX property: <http://www.dke-pr/property#>
                PREFIX state: <http://www.dke-pr/state#>
                PREFIX aggregation: <http://www.dke-pr/aggregation#>
                PREFIX aircraft: <http://www.dke-pr/aircraft#>

                CONSTRUCT {
                    ?aggregation a aggregation:Aggregation ;
                    property:owner ?owner ;
                    #property:countStates ?countStates .
                }
                WHERE {
                    ?state a state:State.
                    ?state property:ofAircraft ?aircraft.
                    ?aircraft a aircraft:Aircraft.
                    ?aircraft property:hasOwner ?hasOwner
                    Filter(?hasOwner = #Owner#)
                    #BIND(Count(?state) as ?countStates)
                    BIND(?hasOwner as ?owner)
                }
        """
    ];
.