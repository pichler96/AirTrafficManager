PREFIX sh:	<http://www.w3.org/ns/shacl#>
@prefix sh:	<http://www.w3.org/ns/shacl#>.
@prefix xsd:	<http://www.w3.org/2001/XMLSchema#>.
@prefix ex: <http://www.w3.org/2022/example#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix aircraft: <http://www.dke-pr/aircraft#>.
@prefix state: <http://www.dke-pr/state#>.
@prefix response: <http://www.dke-pr/response#>.
@prefix property: <http://www.dke-pr/property#>.
@prefix manufacturer: <http://www.dke-pr/manufacturer#>.
@prefix operator: <http://www.dke-pr/operator#>.

ex:AvgAggregationEvent
    a sh:nodeShape;
    sh:targetClass ex:AvgAggregationEvent;
    sh:closed true;

    sh:rule[
        a sh:SPARQLRule;
        sh:prefixes ex:, property: ;
        sh:construct """
            PREFIX ex: <http://www.w3.org/2022/example#>
            PREFIX property: <http://www.dke-pr/property#>
            CONSTRUCT{
                _:avgAggregationEvenent a ex:AvgAggregationEvent;
                event:timestamp ?timestamp ;
                event:owner ?owner ;
                event:avgCount ?avgCount ;
                event:type ?type .
            }
            WHERE {
                select (avg(?count) as ?avg)
                where {
                {SELECT (COUNT(?state) as ?count)
                    where {
                        {
                                GRAPH <http://localhost:3030/DynamicData/1674125711> {
                                    ?state a ex:State ;
                                    property:ofAircraft ?aircraft.
                                }
                            }
                            {
                                GRAPH <http://localhost:3030/StaticData> {
                                    ?aircraft a ex:Aircraft;
                                    property:hasOwner "Private".
                                }
                            }
                    }
                  }
                }
            }
            """
    ];